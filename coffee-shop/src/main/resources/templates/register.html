<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.11/css/intlTelInput.min.css">
    <style>
        body {
            background: url('https://images.prom.ua/760782219_760782219.jpg.jpg') no-repeat center center fixed;
            background-size: cover;
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
        }
        h2 {
            color: #f7f7fd;
            text-align: center;
            margin-top: 15px;
        }

        form {
            max-width: 320px;
            margin: 20px auto;
            padding: 15px;
            background: rgba(250, 185, 185, 0.8);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .error-message {
            color: red;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .input-group-append {
            cursor: pointer;
        }

        .input-group-text {
            background: none;
            border: none;
            padding: 0;
        }
        .error-message {
            color: red;
            font-weight: bold;
        }

        input, button {
            font-size: 0.9rem;
            padding: 8px;
        }

        @media (max-width: 480px) {
            form {
                max-width: 90%;
                margin: 10px auto;
            }
        }
    </style>
</head>
<body>
<h2 class="text-center mt-5">–§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</h2>

<form id="registrationForm" action="/register" method="post">
    <div class="mb-3">
        <label for="id_username" class="form-label">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</label>
        <input type="text" class="form-control" id="id_username" name="username" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è" required>
        <div class="error-message" id="username-error"></div>
    </div>
    <div class="mb-3">
        <label for="id_first_name" class="form-label">–ò–º—è</label>
        <input type="text" class="form-control" id="id_first_name" name="first_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" required>
        <div class="error-message" id="firstname-error"></div>
    </div>
    <div class="mb-3">
        <label for="id_last_name" class="form-label">–§–∞–º–∏–ª–∏—è</label>
        <input type="text" class="form-control" id="id_last_name" name="last_name" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é" required>
        <div class="error-message" id="lastname-error"></div>
    </div>
    <div class="mb-3">
        <label for="id_email" class="form-label">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</label>
        <input type="email" class="form-control" id="id_email" name="email" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã" required>
        <div class="error-message" id="email-error"></div>
    </div>
    <div class="mb-3">
        <label for="id_phone_number" class="form-label">–ù–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</label>
        <input type="tel" class="form-control" id="id_phone_number" name="phone_number" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞" required>
        <div class="error-message" id="phone-error"></div>
    </div>
    <div class="mb-3">
        <label for="id_address" class="form-label">–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è</label>
        <input type="text" class="form-control" id="id_address" name="address" placeholder="–í–≤–µ–¥–∏—Ç–µ –∞–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è" required>
        <div class="error-message" id="address-error"></div>
    </div>
    <div class="mb-3">
        <label for="id_password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
        <div class="input-group">
            <input type="password" class="form-control" id="id_password" name="password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
            <div class="input-group-append">
                <span class="input-group-text" id="togglePassword" onclick="togglePasswordVisibility()">üëÅÔ∏è</span>
            </div>
        </div>
        <div class="error-message" id="password-error"></div>
    </div>
    <div class="mb-3">
        <label for="confirm-password" class="form-label">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è</label>
        <div class="input-group">
            <input type="password" class="form-control" id="confirm-password" placeholder="–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å" required>
            <div class="input-group-append">
                <span class="input-group-text" id="toggleConfirmPassword" onclick="toggleConfirmPasswordVisibility()">üëÅÔ∏è</span>
            </div>
        </div>
        <div class="error-message" id="confirm-password-error"></div>
    </div>
    <button type="submit" class="btn btn-primary w-100">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
    <div th:if="${errors}" class="error-message" th:text="${errors}"></div>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.11/js/intlTelInput.min.js"></script>
<script>

    const phoneInput = document.getElementById("id_phone_number");
    const iti = intlTelInput(phoneInput, {
        initialCountry: "auto",
        geoIpLookup: function(callback) {
            fetch("https://ipinfo.io/json?token=YOUR_API_KEY")  // –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_API_KEY –Ω–∞ –≤–∞—à –∫–ª—é—á –æ—Ç ipinfo.io
                .then(response => response.json())
                .then(data => callback(data.country))
                .catch(() => callback("kg"));
        },
        utilsScript: "https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.11/js/utils.js"
    });

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
    function togglePasswordVisibility() {
        const passwordField = document.getElementById("id_password");
        const passwordIcon = document.getElementById("togglePassword");
        if (passwordField.type === "password") {
            passwordField.type = "text";
            passwordIcon.textContent = "üôà";
        } else {
            passwordField.type = "password";
            passwordIcon.textContent = "üëÅÔ∏è";
    }

    function toggleConfirmPasswordVisibility() {
        const confirmPasswordField = document.getElementById("confirm-password");
        const confirmPasswordIcon = document.getElementById("toggleConfirmPassword");
        if (confirmPasswordField.type === "password") {
            confirmPasswordField.type = "text";
            confirmPasswordIcon.textContent = "üôà";
        } else {
            confirmPasswordField.type = "password";
            confirmPasswordIcon.textContent = "üëÅÔ∏è";
        }
    }

    document.getElementById("registrationForm").addEventListener("submit", function (event) {
        event.preventDefault(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

        // –û—á–∏—â–∞–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –æ—à–∏–±–∫–∏
        let errors = false;
        document.querySelectorAll('.error-message').forEach(function (error) {
            error.textContent = '';
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ
        if (document.getElementById("id_username").value.trim() === "") {
            document.getElementById("username-error").textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.";
            errors = true;
        }
        if (document.getElementById("id_last_name").value.trim() === "") {
            document.getElementById("lastname-error").textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ñ–∞–º–∏–ª–∏—é.";
            errors = true;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã
        const email = document.getElementById("id_email").value;
        const emailPattern = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/;
        if (!emailPattern.test(email)) {
            document.getElementById("email-error").textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã.";
            errors = true;
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
        const phoneNumber = iti.getNumber();
        if (!iti.isValidNumber()) {
            document.getElementById("phone-error").textContent = "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞.";
            errors = true;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
        const password = document.getElementById("id_password").value;
        const confirmPassword = document.getElementById("confirm-password").value;

        // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤
        if (password.length < 8) {
            document.getElementById("password-error").textContent = "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤.";
            errors = true;
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π
        if (password !== confirmPassword) {
            document.getElementById("password-error").textContent = "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.";
            document.getElementById("confirm-password-error").textContent = "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.";
            errors = true;
        }

        // –ï—Å–ª–∏ –Ω–µ—Ç –æ—à–∏–±–æ–∫, –º–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å
        if (!errors) {
            alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ!");
        }
    });
</script>
</body>
</html>
